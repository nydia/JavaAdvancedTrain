<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nydia.mybatis.mapper.UserMapper">

  <resultMap id="associationUserMap" type="com.nydia.mybatis.entity.User">
    <constructor>
      <idArg column="id" javaType="int"/>
    </constructor>
    <result property="id" column="id"/>
    <result property="username" column="username"/>
    <result property="password" column="password"  javaType="java.lang.String" jdbcType="VARCHAR" typeHandler="com.nydia.mybatis.typehandle.MyPasswordTypeHandle"/>
    <association property="parent" javaType="com.nydia.mybatis.entity.User" select="com.nydia.mybatis.mapper.UserMapper.selectById" column="id" fetchType="lazy"/>
    <!-- 分类选择 -->
    <discriminator javaType="string" column="username">
      <!-- 扩充的对象为 boyBean -->
      <case value="name1" resultType="String">
        <!-- 继续扩充其他的属性。 -->
        <result property="desc1" column="desc1"/>
      </case>
      <case value="name2" resultType="String">
        <result property="desc1" column="desc1"/>
      </case>
    </discriminator>
  </resultMap>

  <select id="selectById" parameterType="java.lang.Integer" resultType="com.nydia.mybatis.entity.User">
    select id,username,password
    from tbl_user
    where id = #{id,jdbcType=INTEGER}
  </select>

  <!-- 使用自增主键 -->
  <insert id="insert" useGeneratedKeys="true" keyProperty="id" keyColumn="id" parameterType="com.nydia.mybatis.entity.User">
    insert into tbl_user(username,password) values (#{username},#{password})
  </insert>

  <insert id="insert2" parameterType="com.nydia.mybatis.entity.User">
    <selectKey order="AFTER" keyProperty="id" resultType="INTEGER">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into tbl_user(id,username,password) values (#{id}, #{username},#{password})
  </insert>

  <select id="lasyLoadQuery" parameterType="java.lang.Integer" resultMap="associationUserMap">
    select id,username,password,parent_id
    from tbl_user
    where id = #{id,jdbcType=INTEGER}
  </select>

</mapper>